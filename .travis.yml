language: node_js
sudo: true
node_js:
  - "node"

services:
  - mongodb

env:
#  GIT_USER=stee1
#  GIT_EMAIL=krdima92@gmail.com
  DOCKER_USER=krdmitriy

before_install:
  - ./build.sh

install:
  - ./test.sh
  - ./package.sh
  - ./publish.sh

script: echo "npm test temporarily disabled"

after_success:
  - sed -i -e 's/BUILD_NUMBER=[0-9]*-rc/BUILD_NUMBER=${TRAVIS_BUILD_NUMBER }-rc/g' ./deploy_scripts/upgrade-stage.sh
#  - git config --global user.email "krdima92@gmail.com"
#  - git config --global user.name "stee1"
  - ssh -T git@github.com
  - eval "$(ssh-agent -s)" #start the ssh agent
  - chmod 600 .travis/deploy_key.pem # this key should have push access
  - ssh-add .travis/deploy_key.pem
  - git add ./deploy_scripts/upgrade-stage.sh
  - git commit -m "updated build version"
  - ssh -T git@github.com
  - git push origin master

after_script:
  - ./clean.sh